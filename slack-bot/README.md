# Slack Bot - Weekly Publisher Digest Assistant

AI-powered Slack bot that provides publisher summaries using `/accountsummary` and `/mula` commands.

## 🎯 Features

- **`/accountsummary <publisher> [days]`** - Generate AI-powered publisher summaries
- **`/mula <publisher> [days]`** - Alias for `/accountsummary` 
- **`/health`** - Check system health status
- **Interactive buttons** - Refresh summaries and detailed views
- **Smart search** - Vector-based content search with Pinecone
- **AI summaries** - GPT-4 powered analysis with confidence scoring

## 🚀 Deployment Options

### Option 1: Development with ngrok (Socket Mode)
*Recommended for development and testing* [[memory:2393792]]

```bash
# 1. Set up environment
cp environment.template .env
# Edit .env with your tokens

# 2. Install dependencies
npm install

# 3. Start in Socket Mode
npm run dev:ngrok

# 4. In another terminal, expose via ngrok (optional)
ngrok http 3000
```

**Environment Setup:**
```bash
SLACK_SOCKET_MODE=true
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-signing-secret
SLACK_APP_TOKEN=xapp-your-app-token
```

### Option 2: Production Web App/API

```bash
# 1. Set up production environment
cp environment.template .env
# Edit .env for production

# 2. Install dependencies
npm install

# 3. Start web server
npm start:server
```

**Environment Setup:**
```bash
SLACK_SOCKET_MODE=false
PORT=3000
HOST=0.0.0.0
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-signing-secret
```

## 🌐 Platform Deployments

### Heroku
```bash
# 1. Create Heroku app
heroku create your-slack-bot

# 2. Set environment variables
heroku config:set SLACK_BOT_TOKEN=xoxb-...
heroku config:set SLACK_SIGNING_SECRET=...
heroku config:set SLACK_SOCKET_MODE=false

# 3. Deploy
npm run deploy:heroku
```

### Railway
```bash
# 1. Install Railway CLI
npm install -g @railway/cli

# 2. Login and deploy
railway login
npm run deploy:railway
```

### Vercel
```bash
# 1. Install Vercel CLI
npm install -g vercel

# 2. Deploy
npm run deploy:vercel
```

### Google Apps Script
*For serverless deployment alongside existing webhook*

```javascript
// Create new Google Apps Script project
// Copy slack-bot logic into Apps Script functions
// Deploy as web app
```

## 📡 Webhook Configuration

### For Web App Mode

Configure these endpoints in your Slack app:

- **Request URL**: `https://your-domain.com/slack/events`
- **Interactive Components**: `https://your-domain.com/slack/interactive`
- **Slash Commands**: `https://your-domain.com/slack/commands`

### Health Check

```bash
curl https://your-domain.com/health
```

## 🔧 Configuration

### Required Environment Variables

```bash
# Slack Configuration
SLACK_BOT_TOKEN=xoxb-your-bot-token-here
SLACK_SIGNING_SECRET=your-signing-secret-here

# For Socket Mode (Development)
SLACK_SOCKET_MODE=true
SLACK_APP_TOKEN=xapp-your-app-token-here

# For Web App Mode (Production)
SLACK_SOCKET_MODE=false
PORT=3000

# Pinecone & OpenAI
PINECONE_API_KEY=your-pinecone-key
PINECONE_INDEX_NAME=mulabot-csm
OPENAI_API_KEY=your-openai-key
```

### Optional Configuration

```bash
# Security
ENABLE_RATE_LIMITING=true
ENABLE_CORS=true
ENABLE_HELMET=true

# Monitoring
ENABLE_METRICS=true
LOG_LEVEL=info
```

## 🎮 Usage Examples

### Basic Commands
```
/accountsummary TechCrunch 7
/mula "The Information" 14
/accountsummary Variety 30
/health
```

### Expected Response Format
```
📊 TechCrunch Account Summary

Timeframe: Last 7 days
Sources analyzed: 12 documents
Generated: 12/15/2023, 2:30:45 PM

🔥 Key Highlights
• OpenAI launches GPT-4 Turbo with 128k context window
• Meta announces Llama 2 open-source language model
• Tesla reports record Q3 deliveries exceeding targets

💰 Funding & Financial News
• Anthropic raises $450M Series C led by Spark Capital
• Stability AI secures $101M in funding round

🚀 Product Launches
• Google releases Bard with real-time information
• Microsoft integrates Copilot across Office suite

🟢 Confidence: 89% | Generated by AI from 12 sources
```

## 🔨 Development

### Project Structure
```
slack-bot/
├── app.js              # Socket Mode entry point
├── server.js           # Web App/API entry point  
├── commands/           # Command handlers
├── utils/
│   └── formatting.js   # Slack Block Kit formatting
├── environment.template # Environment variables template
├── package.json
└── README.md
```

### Commands Structure

**Socket Mode (Development):**
- Uses Slack Bolt framework with WebSocket connection
- Ideal for ngrok tunneling and local development
- Real-time event handling

**Web App Mode (Production):**
- Express.js server with REST endpoints
- Webhook-based event handling
- Scalable for production deployment

### Testing

```bash
# Run tests
npm test

# Run with coverage
npm test -- --coverage

# Watch mode
npm run test:watch
```

## 🚨 Troubleshooting

### Common Issues

**Socket Mode Connection Issues:**
```bash
# Check app token
echo $SLACK_APP_TOKEN

# Verify Socket Mode is enabled in Slack app settings
# Ensure SLACK_SOCKET_MODE=true in .env
```

**Web App Mode Issues:**
```bash
# Test health endpoint
curl http://localhost:3000/health

# Check webhook URL in Slack app settings
# Verify SLACK_SOCKET_MODE=false
```

**Command Not Working:**
- Verify slash commands are registered in Slack app
- Check bot has necessary permissions in channel
- Review logs for error messages

### Debug Mode

```bash
LOG_LEVEL=debug npm run dev
```

## 📈 Monitoring

### Health Checks
- `/health` - System status
- `/metrics` - Performance metrics (if enabled)

### Logging
- Request/response logging
- Error tracking with stack traces
- Usage analytics per user/command

## 🔐 Security

- Request signature verification
- Rate limiting (configurable)
- CORS protection
- Helmet.js security headers
- Environment variable isolation

## 📚 Integration

This bot integrates with:
- **Pinecone** - Vector database for content search
- **OpenAI** - GPT-4 for AI summaries and embeddings
- **Google Apps Script** - Document monitoring webhooks
- **Pipedream** - Content processing pipeline

Ready to use with the complete Weekly Publisher Digest Assistant workflow! 